var t=require("@onflow/config"),n=require("@onflow/types"),r=require("@onflow/fcl");function e(t){if(t&&t.t)return t;var n=Object.create(null);return t&&Object.keys(t).forEach(function(r){if("default"!==r){var e=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,e.get?e:{enumerable:!0,get:function(){return t[r]}})}}),n.default=t,n}var o=e(n),c=e(r);const s={emulator:{FlowToken:"0xee82856bf20e2aa6",FungibleToken:"0x0ae53cb6e3f42a79"},testnet:{FlowToken:"0x7e60df042a9c0868",FungibleToken:"0x9a0766d93b6608b7",LockedTokens:"0x95e019a17d0e23d7",StakingProxy:"0x7aad92e5a0715d21",FUSD:"0xe223d8a629e49c68"},mainnet:{FlowToken:"0x1654653399040a61",FungibleToken:"0xf233dcee88fe0abe",LockedTokens:"0x8d0e87b65159ae63",StakingProxy:"0x62430cf28c26d095",FUSD:"0x3c5959b568896393"}},i={mainnet:"https://access-mainnet-beta.onflow.org",testnet:"https://access-testnet.onflow.org",emulator:"http://localhost:8080"},u=function(){try{return Promise.resolve(function(){try{return Promise.resolve(t.config().get("ix.env")).then(function(t){return t||"emulator"})}catch(t){return Promise.reject(t)}}()).then(function(t){return s[t]||s.emulator})}catch(t){return Promise.reject(t)}},a=t=>t.split(/\s/).map(t=>t.replace(/\s/g,"")).filter(t=>t.length>0&&"import"!==t&&"from"!==t),f=(t,n)=>{const[r,e]=n;return t[r]=e,t},l=t=>t&&0!==t.length?t.split("\n").filter(t=>t.includes("import")).map(a).reduce(f,{}):{},p=(t,n={})=>{const r=l(t),e=[];for(const t in r)!n[t]&&Object.prototype.hasOwnProperty.call(r,t)&&e.push(t);return e},m=(t=[],n="")=>{const r="Missing imports for contracts:";console.error(n?`${n} ${r}`:r,t)},d=/(\s*import\s*)([\w\d]+)(\s+from\s*)([\w\d".\\/]+)/g,x=(t,n,r=!0)=>t.replace(d,(t,e,o,c,s)=>{const i=r?o:s;return`${e}${o} from ${(n instanceof Function?n(i):n[i])||s}`}),h=["public","private","storage"],g=t=>{const[n]=t.split("");return n.toUpperCase()+t.slice(1)},P=t=>{switch(!0){case t.indexOf("//")>=0:return"//";case t.indexOf("/")>=0:return"/";case t.indexOf("\\")>=0:return"\\";default:return""}},w=t=>t.replace(/\s+/g," "),y=t=>t.split(",").map(t=>t.replace(/\s*/g,"")).filter(t=>""!==t),v=t=>t.replace(/(\/\*[\s\S]*?\*\/)|(\/\/.*)/g,""),b=(t,n)=>{const r=v(t),e=w(r.replace(/[\n\r]/g,""));if(e){const t=new RegExp(n,"g").exec(e);if(t)return""===t[1]?[]:y(t[1])}return[]},$=t=>b(t,"(?:prepare\\s*\\(\\s*)([^\\)]*)(?:\\))"),S=t=>b(t,"(?:fun\\s+main\\s*\\(\\s*)([^\\)]*)(?:\\))"),k=t=>b(t,"(?:transaction\\s*\\(\\s*)([^\\)]*)(?:\\))"),E=t=>{const n=v(t).replace(/(resource|struct)\s+\w+\s*{[\s\S]+?}/g,""),r=/(?:access\(\w+\)|pub)\s+contract\s+(?:interface)*\s*(\w*)(\s*{[.\s\S]*init\s*\((.*?)\)[.\s\S]*})?/g.exec(n);if(r.length<2)throw new Error("Contract Error: can't find name of the contract");return{contractName:r[1],args:r[3]||""}},F=t=>{const n=v(t);if(/transaction\s*(\(\s*\))*\s*/g.test(n)){const t=$(n),r=k(n);return{type:"transaction",signers:t.length,args:r}}if(/pub\s+fun\s+main\s*/g.test(n))return{type:"script",args:S(n)};if(/\w+\s+contract\s+(\w*\s*)\w*/g.test(n)){const{contractName:t,args:r}=E(n);return{type:"contract",signers:1,args:r,contractName:t}}return{type:"unknown"}},T=t=>!t||"string"!=typeof t,I=t=>!T(t)&&(t.startsWith("Int")||t.startsWith("UInt")||t.startsWith("Word")),A=t=>{if(T(t))return!1;const n=t.replace(/\s/g,"");return n.startsWith("[")&&n.endsWith("]")},N=t=>{if(T(t))return!1;const n=t.replace(/\s/g,"");return n.startsWith("{")&&n.endsWith("}")},j=t=>A(t)||N(t);function O(t,n,r){if(!t.s){if(r instanceof U){if(!r.s)return void(r.o=O.bind(null,t,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(O.bind(null,t,n),O.bind(null,t,2));t.s=n,t.v=r;const e=t.o;e&&e(t)}}const U=function(){function t(){}return t.prototype.then=function(n,r){const e=new t,o=this.s;if(o){const t=1&o?n:r;if(t){try{O(e,1,t(this.v))}catch(t){O(e,2,t)}return e}return this}return this.o=function(t){try{const o=t.v;1&t.s?O(e,1,n?n(o):o):r?O(e,1,r(o)):O(e,2,o)}catch(t){O(e,2,t)}},e},t}(),L={ARGUMENT:"argument"},M=function(t){try{return Promise.resolve(r.config().get("ix.plugins")).then(function(n){const r=(n||{})[t];return!!(r&&r.length>0)&&r})}catch(t){return Promise.reject(t)}};function _(t,n,r){if(!t.s){if(r instanceof q){if(!r.s)return void(r.o=_.bind(null,t,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(_.bind(null,t,n),_.bind(null,t,2));t.s=n,t.v=r;const e=t.o;e&&e(t)}}const q=function(){function t(){}return t.prototype.then=function(n,r){const e=new t,o=this.s;if(o){const t=1&o?n:r;if(t){try{_(e,1,t(this.v))}catch(t){_(e,2,t)}return e}return this}return this.o=function(t){try{const o=t.v;1&t.s?_(e,1,n?n(o):o):r?_(e,1,r(o)):_(e,2,o)}catch(t){_(e,2,t)}},e},t}(),C=t=>t.split(/(\w+)\s*:\s*([\w{}[\]:\s?]*)/).filter(t=>""!==t).map(t=>t.replace(/\s*/g,"")),D=t=>C(t)[1],R=t=>/{(.*)}/.exec(t)[1].split(/([^:]*):(.*)/).map(t=>t.replace(/\s/g,"")).filter(t=>t),B=t=>/\[(.*)\]/.exec(t)[1].replace(/\s+/g,""),H=t=>!T(t)&&(t.includes("?")?o.Optional(o[(t=>t.slice(0,-1))(t)]):o[t]),z=t=>{if(j(t))switch(!0){case A(t):{const n=B(t);return o.Array(z(n))}case N(t):{const[n,r]=R(t),e={key:z(n),value:z(r)};return o.Dictionary(e)}default:return H(t)}return H(t)},G=function(t,n){try{return Promise.resolve(M(L.ARGUMENT)).then(function(r){function e(){let t;const n=z(s);switch(!0){case(t=>{if(T(t))return!1;let n=t.endsWith("?")?t.slice(0,-1):t;return I(n)||(t=>"String"===t)(n)||(t=>"Character"===t)(n)||(t=>"Bool"===t)(n)})(s):return c.arg(o,n);case(t=>!T(t)&&(t.startsWith("Fix64")||t.startsWith("UFix64")))(s):return null===o?c.arg(null,n):(isNaN(parseFloat(o))&&(t=>{throw new Error("Type Error: Expected proper value for fixed type")})(),c.arg(parseFloat(o).toFixed(8),n));case(t=>"Address"===t||"Address?"===t)(s):{const t=null==(p=o)?null:"0x"+(t=>null==t?null:t.replace(/^0x/,""))(p);return c.arg(t,n)}case(t=>"Path"===t||"Path?"===t)(s):return c.arg((t=>{if(t.startsWith("/")){const n=t.slice(1).split("/");if(2!==n.length)throw Error("Incorrect Path - identifier missing");if(!h.includes(n[0]))throw Error("Incorrect Path - wrong domain");const[r,e]=n;return{domain:r,identifier:e}}throw Error("Incorrect Path - shall start with `/`")})(o),n);case A(s):{function r(r){return t?r:c.arg(o,n)}const e=B(s),i=function(){if(j(e))return Promise.resolve(Promise.all(o.map(function(t){try{return Promise.resolve(G(e,t)).then(function({value:t}){return t})}catch(t){return Promise.reject(t)}}))).then(function(r){return t=1,c.arg(r,n)})}();return i&&i.then?i.then(r):r(i)}case N(s):{function e(){return c.arg(p,n)}const[t,r]=R(s),p=[],m=Object.keys(o),d=(i=m,u=function(n){function e(){const n=I(t)?parseInt(c):c;p.push({key:n,value:s})}const c=m[n];let s;const i=function(){if(j(r))return Promise.resolve(G(r,o[c])).then(function(t){s=t.value});s=o[c]}();return i&&i.then?i.then(e):e()},l=-1,function t(n){try{for(;++l<i.length;)if((n=u(l))&&n.then){if(!((r=n)instanceof q&&1&r.s))return void n.then(t,f||(f=_.bind(null,a=new q,2)));n=n.v}a?_(a,1,n):a=n}catch(t){_(a||(a=new q),2,t)}var r}(),a);return d&&d.then?d.then(e):e()}default:throw`${s} is not supported`}var i,u,a,f,l,p}let o=n,s=t;const i=function(){if(r)return Promise.resolve(function(t,n){try{function r(){return{type:u,value:a}}let u=t.type,a=t.value;const f=(e=n,o=function(t){const{resolver:r}=n[t];return Promise.resolve(r(u,a)).then(function(t){u=t.type,a=t.value})},i=-1,function t(n){try{for(;++i<e.length;)if((n=o(i))&&n.then){if(!((r=n)instanceof U&&1&r.s))return void n.then(t,s||(s=O.bind(null,c=new U,2)));n=n.v}c?O(c,1,n):c=n}catch(t){O(c||(c=new U),2,t)}var r}(),c);return Promise.resolve(f&&f.then?f.then(r):r())}catch(t){return Promise.reject(t)}var e,o,c,s,i}({type:t,value:n},r)).then(function(t){o=t.value,s=t.type})}();return i&&i.then?i.then(e):e()})}catch(t){return Promise.reject(t)}},W=function(t=[],n){try{if(t.length>n.length)throw new Error("Not enough arguments");return Promise.all(n.map(function(n,r){try{return Promise.resolve(G(t[r],n)).then(function(t){var n;return(n=t).xform.asArgument(n.value),t})}catch(t){return Promise.reject(t)}}))}catch(t){return Promise.reject(t)}},J=function(t,n=[]){try{const r=F(t).args.map(D);return W(r,n)}catch(t){return Promise.reject(t)}},K=function(t,n){try{if(0===t.length)return Promise.resolve([]);const r=t[0];return Array.isArray(r)&&r.length>0&&r[r.length-1].asArgument?Promise.resolve((t=>t.reduce((t,n)=>[...t,...((t,n)=>{const r=t[t.length-1];return t.slice(0,-1).map(t=>((t,n)=>c.arg(t,n))(t,r))})(n)],[]))(t)):J(n,t)}catch(t){return Promise.reject(t)}};function Q(t,n){try{var r=t()}catch(t){return n(t)}return r&&r.then?r.then(void 0,n):r}const V=function(n,r){try{const{code:e,cadence:o,args:s,addressMap:i,limit:a,processed:f}=n,l=e||o;return Promise.resolve(u()).then(function(o){function u(){return Promise.resolve(t.config().get("ix.executionLimit")).then(function(t){if(d.push(c.limit(a||t||100)),"transaction"===r){const{proposer:t,payer:r,signers:e=[]}=n,o=0===e.length?[r]:e,s=t||r;d.push(c.payer(r)),d.push(c.proposer(s)),d.push(c.authorizations(o))}return c.send(d)})}const p={...o,...i},m=f?l:x(l,p),d="script"===r?[c.script(m)]:[c.transaction(m)],h=function(){if(s)return Promise.resolve(K(s,e)).then(function(t){d.push(c.args(t))})}();return h&&h.then?h.then(u):u()})}catch(t){return Promise.reject(t)}},X=function(t){const{raw:n=!1}=t;return Promise.resolve(Q(function(){return Promise.resolve(V(t,"script")).then(function(t){return n?[t.encodedData,null]:Promise.resolve(c.decode(t)).then(function(t){return[t,null]})})},function(t){return[null,t]}))},Y=function(t){const{wait:n="seal"}=t;return Promise.resolve(Q(function(){return Promise.resolve(V(t,"transaction")).then(function(t){let r;function e(n){return r?n:[t.transactionId,null]}const o=function(){if(n){const e=(t=>{if("string"==typeof t){const n=t.toLowerCase();if(n.includes("final"))return"onceFinalized";if(n.includes("exec"))return"onceExecuted";if(n.includes("seal"))return"onceSealed"}return console.log(`âš ï¸ [33mStatus value [1m[35m"${t}"[33m[2m is not supported. Reverting to [32m"onceSealed"[0m`),"onceSealed"})(n);return Promise.resolve(c.tx(t)[e]()).then(function(n){const e={txId:t,...n};return r=1,[e,null]})}}();return o&&o.then?o.then(e):e(o)})},function(t){return[null,t]}))},Z=function(t){try{const{name:n,to:r,payer:e,proposer:o,code:c,update:s=!1,processed:i=!1,addressMap:u={}}=t,a=i?c:x(c,u),f=s?"\n    transaction(name: String, code: String) {\n      prepare(acct: AuthAccount){\n        let decoded = code.decodeHex()\n        \n        acct.contracts.add(\n          name: name,\n          code: decoded,\n        )\n      }\n    }\n  ":"\n  transaction(name: String, code: String){\n    prepare(acct: AuthAccount){\n      let decoded = code.decodeHex()\n      \n      if acct.contracts.get(name: name) == nil {\n        acct.contracts.add(name: name, code: decoded)\n      } else {\n        acct.contracts.update__experimental(name: name, code: decoded)\n      }\n    }\n  }\n",l=Buffer.from(a,"utf8").toString("hex");let p=r,m=r;return e&&(m=e,p=o||e),Y({payer:m,proposer:p,signers:[r],code:f,args:[n,l]})}catch(t){return Promise.reject(t)}};exports.CONTRACT="contract",exports.PLUGIN_TYPES=L,exports.SCRIPT="script",exports.TRANSACTION="transaction",exports.argType=D,exports.capitalizeFirstLetter=g,exports.collapseSpaces=w,exports.deployContract=Z,exports.executeScript=X,exports.extract=b,exports.extractContractName=t=>{const n=v(t).replace(/\r\n|\n|\r/g," "),r=/\w+\s+contract\s+(?:interface)*\s*(\w*)/g.exec(n);if(r.length<2)throw new Error("Contract Error: can't find name of the contract");return r[1]},exports.extractContractParameters=E,exports.extractImports=l,exports.extractScriptArguments=S,exports.extractSigners=$,exports.extractTransactionArguments=k,exports.generateSchema=y,exports.getArrayType=B,exports.getDictionaryTypes=R,exports.getEnvironment=u,exports.getPlugins=M,exports.getSplitCharacter=P,exports.getTemplateInfo=F,exports.mapArgument=G,exports.mapArguments=W,exports.mapValuesToCode=J,exports.missingImports=p,exports.mutate=Y,exports.query=X,exports.registerPlugin=function(t){try{const{type:n}=t;return Promise.resolve(r.config().get("ix.plugins")).then(function(e){const o=e||{},c=o[n]||[];return Promise.resolve(r.config().put("ix.plugins",{...o,[n]:[...c,t]})).then(function(){})})}catch(t){return Promise.reject(t)}},exports.replaceImportAddresses=x,exports.report=m,exports.reportArguments=(t,n,r="")=>{if(n>t){const e=`Incorrect number of arguments: found ${t} of ${n}`;console.error(r?`${r} ${e}`:e)}},exports.reportMissing=(t="items",n,r,e="")=>{if(r!==n){const o=`Incorrect number of ${t}: found ${n} of ${r}`;console.error(e?`${e} ${o}`:o)}},exports.reportMissingImports=(t,n,r="")=>{const e=p(t,n);e.length>0&&m(e,r)},exports.resolveArguments=K,exports.sendTransaction=Y,exports.setEnvironment=function(n="emulator",r={}){try{const e=n.toLowerCase();if(!s[e])throw new Error(`Provided value "${e}" is not supported. Try "emulator", "testnet" or "mainnet". Default: "emulator"`);const{port:o,endpoint:c,limit:u}=r,a="emulator"===e&&o?`http://localhost:${o}`:i[e],f=c||a;return Promise.resolve(t.config().put("ix.env",e)).then(function(){function n(){return Promise.resolve(t.config().put("accessNode.api",f)).then(function(){})}const r=function(){if(u)return Promise.resolve(t.config().put("ix.executionLimit",u)).then(function(){})}();return r&&r.then?r.then(n):n()})}catch(t){return Promise.reject(t)}},exports.splitArgs=C,exports.trimAndSplit=(t,n,r)=>r?t.replace(n,"").split(r):t.replace(n,"").split(P(t)),exports.underscoreToCamelCase=t=>t.replace(/-/g,"_").split("_").map((t,n)=>n>0?g(t):t).join(""),exports.updateContract=function(t){try{return Z({...t,update:!0})}catch(t){return Promise.reject(t)}};
//# sourceMappingURL=main.js.map
